name: Deploy My Blog to Alibaba Cloud Server ğŸš€

on:
  push:
    branches:
      - main

jobs:
  deploy:
    runs-on: ubuntu-22.04

    steps:
      - name: æ£€å‡ºä»£ç 
        uses: actions/checkout@v3
        with:
          submodules: true # å¯ç”¨ Git å­æ¨¡å—

      - name: æ›´æ–° Git Submodules å¹¶åˆ‡æ¢åˆ°æŒ‡å®š Tag
        run: |
          git submodule update --init --recursive --remote
          cd themes/hugo-PaperMod
          git fetch --tags
          git checkout tags/v7.0
          cd ../..

      - name: å®‰è£… Hugo
        uses: peaceiris/actions-hugo@v2
        with:
          hugo-version: "0.145.0" # æŒ‡å®š Hugo ç‰ˆæœ¬
          extended: true # å¼€å¯ Hugo Extended ç‰ˆï¼ˆæ”¯æŒ SCSS/SASSï¼‰

      - name: ç”Ÿæˆé™æ€æ–‡ä»¶
        run: hugo --gc

      - name: é€šè¿‡ SSH å‘é€æ–‡ä»¶
        uses: appleboy/scp-action@master
        with:
          host: ${{ secrets.SERVER_IP }}
          username: ${{ secrets.SERVER_USER }}
          password: ${{ secrets.SERVER_PASSWORD }}
          # æŒ‡å®šä¸Šä¼  Hugo ç”Ÿæˆçš„ public æ–‡ä»¶å¤¹ä¸­çš„æ‰€æœ‰å†…å®¹
          source: "public/*"
          # æŒ‡å®šè…¾è®¯äº‘æœåŠ¡å™¨ä¸Šç›®æ ‡ç›®å½•
          target: "/www/wwwroot/blog.muyoung.com"
