<?xml version="1.0" encoding="utf-8" standalone="yes"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom" xmlns:content="http://purl.org/rss/1.0/modules/content/">
  <channel>
    <title>硬件直通 on 慕阳博客</title>
    <link>http://localhost:1313/tags/%E7%A1%AC%E4%BB%B6%E7%9B%B4%E9%80%9A/</link>
    <description>Recent content in 硬件直通 on 慕阳博客</description>
    <generator>Hugo -- 0.145.0</generator>
    <language>zh-CN</language>
    <lastBuildDate>Tue, 04 Mar 2025 13:50:14 +0800</lastBuildDate>
    <atom:link href="http://localhost:1313/tags/%E7%A1%AC%E4%BB%B6%E7%9B%B4%E9%80%9A/index.xml" rel="self" type="application/rss+xml" />
    <item>
      <title>Pve开源虚拟化常见配置</title>
      <link>http://localhost:1313/posts/pveconfig/</link>
      <pubDate>Tue, 04 Mar 2025 13:50:14 +0800</pubDate>
      <guid>http://localhost:1313/posts/pveconfig/</guid>
      <description>&lt;h2 id=&#34;删除local-lvm&#34;&gt;删除local-lvm&lt;/h2&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;lvremove pve/data

lvextend -l +100%FREE -r pve/root
&lt;/code&gt;&lt;/pre&gt;&lt;h2 id=&#34;挂载swap文件&#34;&gt;挂载swap文件&lt;/h2&gt;
&lt;p&gt;删除pve自带swap分区&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;swapoff -a

lvremove /dev/pve/swap

lvresize -l +100%FREE /dev/pve/root
以文件形式

#创建一个16G的swap，bs * count =16G

dd if=/dev/zero of=/swapfile bs=1G count=16

#配置安全的权限

chmod 0600 /swapfile

#格式化成swap

mkswap /swapfile

#挂载swap

swapon /swapfile

#验证

free -h

nano /etc/fstab      开机自动挂载

/swapfile  swap      swap    defaults   0       0

调整swap阈值

vi /etc/sysctl.conf 

sysctl -p
&lt;/code&gt;&lt;/pre&gt;&lt;h2 id=&#34;硬件直通&#34;&gt;硬件直通&lt;/h2&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;Intel CPU

对于Intel CPU，添加 intel_iommu=on，操作如下：

1、Shell 里面输入命令：nano /etc/default/grub

root@pve:~# nano /etc/default/grub

2、在里面找到：GRUB_CMDLINE_LINUX_DEFAULT=&amp;#34;quiet&amp;#34;

然后修改为

GRUB_CMDLINE_LINUX_DEFAULT=&amp;#34;quiet intel_iommu=on&amp;#34;

编辑完成后，使用快捷键 Ctrl + O 回车保存文件，Ctrl + X 退出编辑器。

3、使用命令 update-grub 保存更改并更新grub

root@pve:~# update-grub

4、更新完成后，使用命令 reboot 重启PVE系统

root@pve:~# reboot

从命令行运行 dmesg | grep -e DMAR -e IOMMU 如果没有输出，则说明有问题。

如果有,可基本确认这个过程顺利完成! 接下来就可以为虚拟机正常的添加硬件直通了。
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;-&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;-&lt;/p&gt;</description>
    </item>
    <item>
      <title>vSphere Hypervisor(ESXI)</title>
      <link>http://localhost:1313/posts/esxi/</link>
      <pubDate>Thu, 27 Feb 2025 17:37:05 +0800</pubDate>
      <guid>http://localhost:1313/posts/esxi/</guid>
      <description>&lt;h2 id=&#34;vmware-ovf-tool导出虚拟机&#34;&gt;VMware OVF Tool导出虚拟机&lt;/h2&gt;
&lt;p&gt;1安装VMware-ovftool-4.3.0-12320924-win.x86_64.msi&lt;/p&gt;
&lt;p&gt;2进入安装目录 C:\Program Files\VMware\VMware OVF Tool\ 输入cmd进入命令提示符&lt;/p&gt;
&lt;p&gt;&lt;img alt=&#34;image.png&#34; loading=&#34;lazy&#34; src=&#34;https://r.muyoung.com/blogimg/20250312134601037.png&#34;&gt;&lt;/p&gt;
&lt;p&gt;`&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;ovftool vi://root:@192.168.1.10/RockyLinuxServer E:\ovf\RockyLinuxServer.ova

ovftool vi://root:@192.168.1.10/WindowsServer2022 E:\ovf\WindowsServer2022.ova

ovftool vi://root:@192.168.1.10/DSM920 E:\ovf\DSM920.ova
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;`&lt;/p&gt;
&lt;h2 id=&#34;esxi直通板载sata控制器&#34;&gt;ESXI直通板载SATA控制器&lt;/h2&gt;
&lt;p&gt;&lt;img alt=&#34;image.png&#34; loading=&#34;lazy&#34; src=&#34;https://r.muyoung.com/blogimg/20250312134702011.png&#34;&gt;&lt;/p&gt;
&lt;p&gt;1查看”设备ID“和“供应商ID”&lt;/p&gt;
&lt;p&gt;2SSH，不细表&lt;/p&gt;
&lt;p&gt;3打开直通映射文件：&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;vi /etc/vmware/passthru.map
&lt;/code&gt;&lt;/pre&gt;&lt;ol start=&#34;4&#34;&gt;
&lt;li&gt;编辑如下内容：&lt;/li&gt;
&lt;/ol&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;\# Union Point-H AHCI Controller

\# &amp;lt;供应商ID&amp;gt; &amp;lt;设备ID&amp;gt; d3d0 default

8086 a282 d3d0 default
&lt;/code&gt;&lt;/pre&gt;&lt;ol start=&#34;5&#34;&gt;
&lt;li&gt;
&lt;p&gt;重启ESXi&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;选中 Union Point-H AHCI Controller，点击“切换直通”，大功告成&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;h2 id=&#34;修改esxi的证书&#34;&gt;修改ESXI的证书&lt;/h2&gt;
&lt;p&gt;连接SSH 进入 /etc/vmware/ssl 目录，找到 rui.key,rui.crt (注意备份原证书)选中删除，将之前修改好的ssl证书复制到该目录&lt;/p&gt;
&lt;p&gt;如果不想重启esxi主机，可以在SSH下输入：&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;/etc/init.d/hostd restart

/etc/init.d/vpxa restart
&lt;/code&gt;&lt;/pre&gt;</description>
    </item>
  </channel>
</rss>
