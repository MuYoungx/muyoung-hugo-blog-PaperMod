<?xml version="1.0" encoding="utf-8" standalone="yes"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>硬件直通 on 慕阳博客</title>
    <link>http://localhost:1313/tags/%E7%A1%AC%E4%BB%B6%E7%9B%B4%E9%80%9A/</link>
    <description>Recent content in 硬件直通 on 慕阳博客</description>
    <generator>Hugo</generator>
    <language>zh-CN</language>
    <lastBuildDate>Tue, 04 Mar 2025 13:50:14 +0800</lastBuildDate>
    <atom:link href="http://localhost:1313/tags/%E7%A1%AC%E4%BB%B6%E7%9B%B4%E9%80%9A/index.xml" rel="self" type="application/rss+xml" />
    <item>
      <title>Pve开源虚拟化常见配置</title>
      <link>http://localhost:1313/posts/pveconfig/</link>
      <pubDate>Tue, 04 Mar 2025 13:50:14 +0800</pubDate>
      <guid>http://localhost:1313/posts/pveconfig/</guid>
      <description>&lt;h2 id=&#34;删除local-lvm&#34;&gt;删除local-lvm&lt;/h2&gt;&#xA;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;lvremove pve/data&#xD;&#xA;&#xD;&#xA;lvextend -l +100%FREE -r pve/root&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;h2 id=&#34;挂载swap文件&#34;&gt;挂载swap文件&lt;/h2&gt;&#xA;&lt;p&gt;删除pve自带swap分区&lt;/p&gt;&#xA;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;swapoff -a&#xD;&#xA;&#xD;&#xA;lvremove /dev/pve/swap&#xD;&#xA;&#xD;&#xA;lvresize -l +100%FREE /dev/pve/root&#xD;&#xA;以文件形式&#xD;&#xA;&#xD;&#xA;#创建一个16G的swap，bs * count =16G&#xD;&#xA;&#xD;&#xA;dd if=/dev/zero of=/swapfile bs=1G count=16&#xD;&#xA;&#xD;&#xA;#配置安全的权限&#xD;&#xA;&#xD;&#xA;chmod 0600 /swapfile&#xD;&#xA;&#xD;&#xA;#格式化成swap&#xD;&#xA;&#xD;&#xA;mkswap /swapfile&#xD;&#xA;&#xD;&#xA;#挂载swap&#xD;&#xA;&#xD;&#xA;swapon /swapfile&#xD;&#xA;&#xD;&#xA;#验证&#xD;&#xA;&#xD;&#xA;free -h&#xD;&#xA;&#xD;&#xA;nano /etc/fstab      开机自动挂载&#xD;&#xA;&#xD;&#xA;/swapfile  swap      swap    defaults   0       0&#xD;&#xA;&#xD;&#xA;调整swap阈值&#xD;&#xA;&#xD;&#xA;vi /etc/sysctl.conf &#xD;&#xA;&#xD;&#xA;sysctl -p&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;h2 id=&#34;硬件直通&#34;&gt;硬件直通&lt;/h2&gt;&#xA;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;Intel CPU&#xD;&#xA;&#xD;&#xA;对于Intel CPU，添加 intel_iommu=on，操作如下：&#xD;&#xA;&#xD;&#xA;1、Shell 里面输入命令：nano /etc/default/grub&#xD;&#xA;&#xD;&#xA;root@pve:~# nano /etc/default/grub&#xD;&#xA;&#xD;&#xA;2、在里面找到：GRUB_CMDLINE_LINUX_DEFAULT=&amp;#34;quiet&amp;#34;&#xD;&#xA;&#xD;&#xA;然后修改为&#xD;&#xA;&#xD;&#xA;GRUB_CMDLINE_LINUX_DEFAULT=&amp;#34;quiet intel_iommu=on&amp;#34;&#xD;&#xA;&#xD;&#xA;编辑完成后，使用快捷键 Ctrl + O 回车保存文件，Ctrl + X 退出编辑器。&#xD;&#xA;&#xD;&#xA;3、使用命令 update-grub 保存更改并更新grub&#xD;&#xA;&#xD;&#xA;root@pve:~# update-grub&#xD;&#xA;&#xD;&#xA;4、更新完成后，使用命令 reboot 重启PVE系统&#xD;&#xA;&#xD;&#xA;root@pve:~# reboot&#xD;&#xA;&#xD;&#xA;从命令行运行 dmesg | grep -e DMAR -e IOMMU 如果没有输出，则说明有问题。&#xD;&#xA;&#xD;&#xA;如果有,可基本确认这个过程顺利完成! 接下来就可以为虚拟机正常的添加硬件直通了。&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;-&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;&amp;mdash;-&lt;/p&gt;</description>
    </item>
    <item>
      <title>vSphere Hypervisor(ESXI)</title>
      <link>http://localhost:1313/posts/esxi/</link>
      <pubDate>Thu, 27 Feb 2025 17:37:05 +0800</pubDate>
      <guid>http://localhost:1313/posts/esxi/</guid>
      <description>&lt;h2 id=&#34;vmware-ovf-tool导出虚拟机&#34;&gt;VMware OVF Tool导出虚拟机&lt;/h2&gt;&#xA;&lt;p&gt;1安装VMware-ovftool-4.3.0-12320924-win.x86_64.msi&lt;/p&gt;&#xA;&lt;p&gt;2进入安装目录 C:\Program Files\VMware\VMware OVF Tool\ 输入cmd进入命令提示符&lt;/p&gt;&#xA;&lt;p&gt;&lt;img src=&#34;https://r.muyoung.com/blogimg/20250312134601037.png&#34; alt=&#34;image.png&#34;&gt;&lt;/p&gt;&#xA;&lt;p&gt;`&lt;/p&gt;&#xA;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;ovftool vi://root:@192.168.1.10/RockyLinuxServer E:\ovf\RockyLinuxServer.ova&#xD;&#xA;&#xD;&#xA;ovftool vi://root:@192.168.1.10/WindowsServer2022 E:\ovf\WindowsServer2022.ova&#xD;&#xA;&#xD;&#xA;ovftool vi://root:@192.168.1.10/DSM920 E:\ovf\DSM920.ova&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;`&lt;/p&gt;&#xA;&lt;h2 id=&#34;esxi直通板载sata控制器&#34;&gt;ESXI直通板载SATA控制器&lt;/h2&gt;&#xA;&lt;p&gt;&lt;img src=&#34;https://r.muyoung.com/blogimg/20250312134702011.png&#34; alt=&#34;image.png&#34;&gt;&lt;/p&gt;&#xA;&lt;p&gt;1查看”设备ID“和“供应商ID”&lt;/p&gt;&#xA;&lt;p&gt;2SSH，不细表&lt;/p&gt;&#xA;&lt;p&gt;3打开直通映射文件：&lt;/p&gt;&#xA;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;vi /etc/vmware/passthru.map&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;ol start=&#34;4&#34;&gt;&#xA;&lt;li&gt;编辑如下内容：&lt;/li&gt;&#xA;&lt;/ol&gt;&#xA;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;\# Union Point-H AHCI Controller&#xD;&#xA;&#xD;&#xA;\# &amp;lt;供应商ID&amp;gt; &amp;lt;设备ID&amp;gt; d3d0 default&#xD;&#xA;&#xD;&#xA;8086 a282 d3d0 default&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;ol start=&#34;5&#34;&gt;&#xA;&lt;li&gt;&#xA;&lt;p&gt;重启ESXi&lt;/p&gt;&#xA;&lt;/li&gt;&#xA;&lt;li&gt;&#xA;&lt;p&gt;选中 Union Point-H AHCI Controller，点击“切换直通”，大功告成&lt;/p&gt;&#xA;&lt;/li&gt;&#xA;&lt;/ol&gt;&#xA;&lt;h2 id=&#34;修改esxi的证书&#34;&gt;修改ESXI的证书&lt;/h2&gt;&#xA;&lt;p&gt;连接SSH 进入 /etc/vmware/ssl 目录，找到 rui.key,rui.crt (注意备份原证书)选中删除，将之前修改好的ssl证书复制到该目录&lt;/p&gt;&#xA;&lt;p&gt;如果不想重启esxi主机，可以在SSH下输入：&lt;/p&gt;&#xA;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;/etc/init.d/hostd restart&#xD;&#xA;&#xD;&#xA;/etc/init.d/vpxa restart&#xA;&lt;/code&gt;&lt;/pre&gt;</description>
    </item>
  </channel>
</rss>
